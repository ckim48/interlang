<!-- templates/achievements.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Achievements</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" sizes="32x32">
<link rel="apple-touch-icon" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}" sizes="180x180">

  <style>
    :root{
      /* Light theme tokens aligned with nav.html */
      --ink:#0e1b35; --muted:#4b5567; --bg:#ffffff; --bg-soft:#f7f9ff;
      --grid:#0e1b3514; --brand:#3b82f6; --accent:#8f9bff; --ring:#cfe2ff;
      --ok:#22c55e; --gold:#f59e0b; --bad:#ef4444;
    }
    html,body{height:100%}
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--ink); background:var(--bg);
      background-image:
        radial-gradient(36vmax 36vmax at 12% 6%, #eef4ff 0%, transparent 70%),
        radial-gradient(32vmax 32vmax at 88% 0%, #f3f6ff 0%, transparent 70%),
        radial-gradient(30vmax 30vmax at 10% 90%, #f7faff 0%, transparent 70%);
      background-attachment: fixed;
    }

    /* Header card (light) */
    .page-header{
      background: linear-gradient(180deg,#fff,#f7faff);
      border:1px solid #e6ecff; border-radius:20px; padding:24px;
      box-shadow:0 18px 44px rgba(13,31,64,.08); position:relative;
    }
    .page-header::after{
      content:""; position:absolute; left:20px; right:20px; bottom:-1px; height:2px;
      background:linear-gradient(90deg,transparent,#cfe0ff,#e0e7ff,transparent);
      border-radius:2px; opacity:.9;
    }

    .progress{ height:12px; background:#eef3ff; border:1px solid #e2ebff; border-radius:999px; overflow:hidden; }
    .progress-bar{ background:linear-gradient(90deg,var(--brand),var(--accent)); color:#fff; font-weight:800; font-size:.72rem; }

    .section-title{
      font-weight:800; letter-spacing:.2px; color:#1f2b46;
      font-size:clamp(18px,2.5vw,20px);
    }
    .section-sub{ color:var(--muted) }

    /* Glassy light cards */
    .card-glass{
      border:1px solid #e6ecff;
      background:linear-gradient(180deg,#fff,#f7faff);
      border-radius:18px; box-shadow:0 10px 28px rgba(13,31,64,.06);
    }

    /* Achievement tile (light) with accent spine */
    .ach-card{
      position:relative; display:flex; gap:.6rem; align-items:flex-start;
      border:1px solid #e6ecff; border-radius:16px; padding:14px;
      background:linear-gradient(180deg,#fff,#f7faff);
      box-shadow:0 10px 22px rgba(13,31,64,.06);
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      overflow:hidden;
    }
    .ach-card::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:6px;
      background:linear-gradient(180deg,var(--brand),var(--accent));
      opacity:.9;
    }
    .ach-card:hover{ transform:translateY(-2px); box-shadow:0 16px 34px rgba(13,31,64,.10); border-color:#d9e6ff; }

    .ach-icon{
      width:40px; height:40px; border-radius:12px; display:inline-flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg,#fff,#f3f7ff); border:1px solid #e6ecff; color:#223357; font-size:1.1rem;
      box-shadow:0 6px 16px rgba(13,31,64,.06);
    }
    .ach-earned{
      border-color:#c7f0d5;
      box-shadow:inset 0 0 0 1px #c7f0d5, 0 10px 22px rgba(13,31,64,.06);
    }
    .ach-locked{ opacity:.9 }

    .chip{
      border-radius:999px; padding:.2rem .55rem; font-weight:800; font-size:.78rem;
      background:linear-gradient(180deg,#fff,#f3f7ff); color:#223357; border:1px solid #e6ecff;
    }
    .chip-gold{
      background:linear-gradient(180deg,#fff8e6,#fff3cc); border-color:#ffe3a3; color:#5e4300;
    }
    .chip-green{
      background:linear-gradient(180deg,#eafff3,#d7ffe9); border-color:#baf3d0; color:#0b3b22;
    }
    .titles-wrap .chip{ margin:0 .35rem .35rem 0; }

    .muted{ color:var(--muted) }
  </style>
</head>
<body>
  <!-- Include global navbar (light, non-transparent) -->
  {% include 'nav.html' %}

  <div class="container pb-5 mt-4">
    <!-- Header with XP progress -->
    <div class="page-header mb-4 d-flex flex-column flex-md-row align-items-md-center justify-content-between">
      <div class="pe-md-4">
        <h1 class="h3 mb-1" style="font-weight:800; letter-spacing:.2px;">Your Achievements</h1>
        <div class="muted">Collect badges and titles as you play boards.</div>
      </div>

      <div class="mt-3 mt-md-0 w-100" style="max-width:460px;">
        {% set current_xp = (user_xp | default(0)) % 100 %}
        {% set xp_needed = 0 if user_level >= 5 else 100 - current_xp %}
        {% if user_level < 5 %}
          <div class="small mb-2 muted">XP Progress ({{ current_xp }}/100)</div>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ current_xp }}%;" aria-valuenow="{{ current_xp }}" aria-valuemin="0" aria-valuemax="100">
              {{ current_xp }} XP
            </div>
          </div>
          <div class="small mt-1 text-end muted">{{ xp_needed }} XP to Level {{ user_level + 1 }}</div>
        {% else %}
          <div class="small mb-1 muted">Max Level Reached</div>
          <div class="h5 mb-0" style="color:var(--ok); font-weight:800">Expert</div>
        {% endif %}
      </div>
    </div>

    <!-- Overview -->
    {% set earned = achievements_earned|default(0) %}
    {% set total  = achievements_total|default(0) %}
    {% set pct    = 0 if total == 0 else ((earned * 100) // total) %}
    <div class="row g-3 mb-3">
      <div class="col-md-7">
        <div class="card-glass p-3 h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-bold">Overall Progress</div>
            <div class="chip chip-green"><i class="bi bi-trophy me-1"></i>{{ earned }}/{{ total }}</div>
          </div>
          <div class="progress mb-2"><div class="progress-bar" style="width: {{ pct }}%;">{{ pct }}%</div></div>
          <div class="small muted">Earn more by perfect boards, high lines, and long-answer mastery.</div>
        </div>
      </div>
      <div class="col-md-5">
        <div class="card-glass p-3 h-100">
          <div class="fw-bold mb-2">Your Collected Titles</div>
          <div class="titles-wrap">
            {% if earned_titles and earned_titles|length > 0 %}
              {% for t in earned_titles %}
                <span class="chip chip-gold"><i class="bi bi-award me-1"></i>{{ t }}</span>
              {% endfor %}
            {% else %}
              <div class="muted">No titles yet â€” unlock some by earning achievements.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Achievements Grid -->
    <div class="mb-3">
      <h2 class="h5 section-title mb-1">All Badges</h2>
      <div class="section-sub">Everything you can unlock.</div>
    </div>

    <div class="row g-3">
      {% set earned_codes = earned_codes|default([]) %}
      {% for ach in items %}
        {% set got = ach['code'] in earned_codes %}
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="ach-card {% if got %}ach-earned{% else %}ach-locked{% endif %}">
            <div class="ach-icon me-2"><i class="bi {{ ach['icon'] }}"></i></div>
            <div class="flex-grow-1">
              <div class="d-flex align-items-center justify-content-between">
                <div class="fw-bold">{{ ach['name'] }}</div>
                {% if got %}
                  <span class="chip chip-green"><i class="bi bi-check2-circle"></i> Earned</span>
                {% else %}
                  <span class="chip"><i class="bi bi-lock"></i> Locked</span>
                {% endif %}
              </div>
              <div class="small mt-1 muted">{{ ach['description'] }}</div>
              {% if ach['unlocked_at'] %}
                <div class="small mt-1"><i class="bi bi-clock-history me-1"></i>
                  Unlocked: {{ ach['unlocked_at'] }}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
      {% if items|length == 0 %}
        <div class="section-sub">No achievements defined yet.</div>
      {% endif %}
    </div>

    <div class="text-center mt-4">
      <a class="btn chip" href="{{ url_for('home') }}"><i class="bi bi-arrow-left me-1"></i> Back to Home</a>
    </div>
  </div>

  <!-- Bootstrap JS (needed for nav dropdown) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
